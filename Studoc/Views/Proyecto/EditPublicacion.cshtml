@model Publicacion

@{
    ViewData["Title"] = "Editar Publicaciones";
}

<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width" />
    <title>@ViewBag.Title</title>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f2f2f2;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 5px;
            box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.1);
        }

        h2 {
            font-size: 24px;
            margin-bottom: 20px;
        }

        form {
            margin-top: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
        }

        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 15px;
        }

        #editor {
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        button[type="submit"] {
            background-color: #007BFF;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</head>

<body>
    <div class="container">
        <h2>@ViewBag.Title</h2>

        <form method="post" asp-action="EditPublicacion" asp-route-id="@Model.ID">
            @Html.AntiForgeryToken()

            <label for="Titulo">Título:</label>
            <input type="text" id="Titulo" name="Titulo" value="@Model.Titulo" />

            <div id="editor">@Html.Raw(Model.Paso_1)</div>

            <button type="submit">Guardar Contenido</button>
        </form>
    </div>

    <script>
        var quill = new Quill('#editor', {
            theme: 'snow',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline', 'strike'], // Formato de texto
                    ['link'], // Enlace
                    [{ 'header': 1 }, { 'header': 2 }, 'blockquote'], // Encabezados y bloque de citas
                    [{ 'list': 'ordered' }, { 'list': 'bullet' }], // Listas ordenadas y no ordenadas
                    [{ 'script': 'sub' }, { 'script': 'super' }], // Subíndice y superíndice
                    [{ 'indent': '-1' }, { 'indent': '+1' }], // Aumentar y disminuir sangría
                    ['image'], // Insertar imagen
                    ['clean'] // Limpiar formato
                ]
            }
        });

        document.querySelector('form').addEventListener('submit', function (e) {
            // Obtiene el contenido en formato HTML
            var contenidoHtml = quill.root.innerHTML;


            // Limpia el contenido HTML para eliminar etiquetas no deseadas
            var cleanHtml = stripHtmlTags(contenidoHtml);

            // Agrega el contenido limpio al campo oculto para enviarlo al servidor
            var contenidoInput = document.createElement('input');
            contenidoInput.type = 'hidden';
            contenidoInput.name = 'contenido';
            contenidoInput.value = cleanHtml;
            this.appendChild(contenidoInput);
        });

        function stripHtmlTags(html) {
            var doc = new DOMParser().parseFromString(html, 'text/html');
            return doc.body.textContent || "";
        }

        // Ajustar tamaño de imagen después de insertarla
        quill.on('editor-change', function (eventName, ...args) {
            if (eventName === 'text-change') {
                var images = document.querySelectorAll('.ql-editor img');
                images.forEach(function (img) {
                    img.style.maxWidth = '50%'; // Ajustar ancho máximo
                    img.style.height = 'auto';   // Ajustar altura automáticamente
                });
            }
        });
    </script>
</body>

</html>